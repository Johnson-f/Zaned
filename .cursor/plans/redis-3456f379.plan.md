<!-- 3456f379-6b65-479a-88cb-416865d95a43 c8c6394b-6592-4f6e-9bce-bfebccd40f3f -->
# Caching Redesign Plan

## 1. Bootstrap Symbol Cache

- **bootstrap-cache**: On server start (in [backend/main.go](backend/main.go)), query the `screener` table once, push all symbols into Redis (e.g., list/set `cache:screener:symbols`). Provide helper in `[backend/service/caching/bootstrap.go]` (new file) to encapsulate loading logic and reuse later.

## 2. Symbol Retrieval Abstraction

- **symbol-service**: Create a small `SymbolRepository` in `[backend/service/screener_symbols.go]` that reads from Redis and exposes `GetAllSymbols()` for other services. Fallback to DB if cache empty, but repopulate cache when that happens. Replace existing direct DB symbol reads in services (historical, screener filters, etc.) with this abstraction.

## 3. Data Fetch â†’ Cache Flow

- **cache-first-read**: Update services such as `[backend/service/historical.go]`, `[backend/service/market-statistics.go]`, `[backend/service/company-info.go]`, etc., so that they:

1. Pull symbol lists via `SymbolRepository` (cache-first).
2. Fetch external data as needed.
3. Store resulting payloads in Redis (new cache keys per endpoint) instead of immediately writing to Postgres.
4. When Redis is unavailable, log and gracefully fall back to current DB behavior.

## 4. Manual Persistence Endpoint/CLI

- **manual-persist**: Implement an admin route or CLI command (e.g., Fiber handler under `[backend/routes/admin.go]` or `cmd/save-cache.go`) that:

1. Reads cached payloads awaiting persistence (define a deterministic key pattern, e.g., `cache:persist:*`).
2. Writes them to the database in batches.
3. Clears the processed cache entries.
Add authentication/guards if exposed via HTTP.

## 5. Cache Management Utilities

- **cache-utils**: Extend `[backend/service/caching]` with helpers to:
- Read/write symbol sets (`SetSymbols`, `GetSymbols`).
- Store queued DB-writes (`QueuePersistence`, `DrainPersistence`).
- Monitor cache health (reuse `monitor.go`).

## 6. Configuration & Docs

- **config-docs**: Update env/config docs (`[backend/DEPLOYMENT.md]`, `.env.example`) with new Redis keys and manual persistence workflow. Document operational steps for the admin endpoint/CLI.

### To-dos

- [ ] Load screener symbols into Redis during startup
- [ ] Create cache-first symbol repository + update consumers
- [ ] Make services fetch symbols/data from Redis + store results there
- [ ] Add manual persistence command/endpoint to flush cache to DB
- [ ] Add Redis helpers for symbols + persistence queues
- [ ] Update docs/env for new caching workflow